import"./styles-CCyJblTz.js";import{i as U}from"./ads-D-IuExRI.js";import{N as A}from"./types-CWP0aW2C.js";const k=document.querySelector("#result"),u=document.querySelector("#share-image"),d=document.querySelector("#share-link"),L=sessionStorage.getItem("nsolo_result");let f=sessionStorage.getItem("nsolo_face");const P=new URLSearchParams(location.search),x=P.get("lang")||"ko",T={ko:{title:"나는 솔로에 나간다면 나의 이름은?",subtitle:"Top 3 이름 결과를 확인해보세요.",retry:"다시 분석",empty:"결과가 없습니다. 다시 분석해주세요.",uncertain:"유사한 타입이 겹쳐 보여요. 더 정면/근거리 얼굴 사진으로 다시 시도해보세요.",confidenceHigh:"매칭 신뢰도 높음",confidenceMid:"매칭 신뢰도 보통",confidenceLow:"매칭 신뢰도 낮음",retryGuide:"정면/밝은 조명/단독 얼굴로 다시 촬영하면 정확도가 올라갑니다.",topHint:"인상 키워드 기반으로 가장 가까운 타입입니다.",shareImage:"결과 이미지 공유",shareLink:"결과 링크 복사",copied:"복사됨!",copiedDesc:"친구에게 링크를 붙여넣어 공유해보세요.",topPick:"오늘의 시그니처 타입",facePreview:"탐지된 얼굴",shareCardTitle:"나의 나는솔로 이름은",shareCardBadge:"오락용 아키타입 분류 · 실존 인물 식별 아님"},en:{title:"If you joined I AM SOLO, what would your name be?",subtitle:"Check your Top 3 name results.",retry:"Try Again",empty:"No result found. Please run analysis again.",uncertain:"The top matches are very close. Try again with a clearer front-face photo.",confidenceHigh:"Match confidence: High",confidenceMid:"Match confidence: Medium",confidenceLow:"Match confidence: Low",retryGuide:"Retry with a front-facing, well-lit, single-face photo for better accuracy.",topHint:"Closest type based on visual impression keywords.",shareImage:"Share Image",shareLink:"Copy Link",copied:"Copied!",copiedDesc:"Paste the link to share with friends.",topPick:"Today's signature type",facePreview:"Detected face",shareCardTitle:"My I AM SOLO name is",shareCardBadge:"Entertainment archetype only · not identity recognition"},ja:{title:"나는 솔로 に出たら、私の名前は？",subtitle:"Top 3 名前の結果を確認してください。",retry:"もう一度分析",empty:"結果がありません。もう一度分析してください。",uncertain:"上位候補が近すぎます。正面で鮮明な顔写真で再試行してください。",confidenceHigh:"マッチ信頼度: 高い",confidenceMid:"マッチ信頼度: 普通",confidenceLow:"マッチ信頼度: 低い",retryGuide:"正面・明るい環境・単独の顔写真で再試行すると精度が上がります。",topHint:"印象キーワードベースで最も近いタイプです。",shareImage:"画像を共有",shareLink:"リンクをコピー",copied:"コピー完了!",copiedDesc:"リンクを貼り付けて友だちに共有できます。",topPick:"今日のシグネチャータイプ",facePreview:"検出された顔",shareCardTitle:"私の I AM SOLO 名前は",shareCardBadge:"エンタメ用アーキタイプ分類 · 実在人物識別ではありません"}},i=T[x]||T.ko,M=document.querySelector(".hero h1"),$=document.querySelector(".hero p"),b=document.querySelector(".row .btn.ghost"),p=document.querySelector("#toast");M&&(M.textContent=i.title);$&&($.textContent=i.subtitle);u&&(u.textContent=i.shareImage);d&&(d.textContent=i.shareLink);b&&(b.textContent=i.retry,b.href=`/scan.html?lang=${encodeURIComponent(x)}`);function B(c,a=""){p&&(p.innerHTML=`<strong>${c}</strong>${a?`<span>${a}</span>`:""}`,p.classList.add("show"),setTimeout(()=>p.classList.remove("show"),1400))}function E(c,a){const e={rows:c.map(s=>({slug:s.slug,p:s.p})),face:a||void 0};return btoa(unescape(encodeURIComponent(JSON.stringify(e))))}function q(c){if(!c)return null;try{return JSON.parse(decodeURIComponent(escape(atob(c))))}catch{return null}}async function D(c){if(!c)return null;const a=c;try{const e=await new Promise((r,o)=>{const t=new Image;t.onload=()=>r(t),t.onerror=o,t.src=a}),s=document.createElement("canvas");s.width=64,s.height=64;const h=s.getContext("2d");return h?(h.drawImage(e,0,0,64,64),s.toDataURL("image/jpeg",.55)):a}catch{return a}}async function N(c){const a=document.createElement("canvas");a.width=1080,a.height=1350;const e=a.getContext("2d"),s=e.createLinearGradient(0,0,1080,1350);s.addColorStop(0,"#101827"),s.addColorStop(.5,"#1e1b4b"),s.addColorStop(1,"#312e81"),e.fillStyle=s,e.fillRect(0,0,a.width,a.height),e.fillStyle="rgba(255,255,255,0.12)",e.beginPath(),e.arc(900,180,220,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(200,1160,280,0,Math.PI*2),e.fill(),e.fillStyle="#dbeafe",e.font="700 30px system-ui",e.fillText("AI FACE MATCH",80,84),e.fillStyle="#ffffff",e.font="800 64px system-ui",e.fillText(i.shareCardTitle,80,156);const h=c[0];if(e.fillStyle="#a5b4fc",e.font="700 44px system-ui",e.fillText(`${h?.label??"-"} 타입`,80,214),f){const r=f;try{const o=await new Promise((H,O)=>{const m=new Image;m.onload=()=>H(m),m.onerror=O,m.src=r}),t=460,n=460,y=80,w=250,S=Math.max(t/o.width,n/o.height),v=o.width*S,C=o.height*S,I=y+(t-v)/2,R=w+(n-C)/2;e.save(),e.beginPath(),e.roundRect(y,w,t,n,28),e.clip(),e.drawImage(o,I,R,v,C),e.restore(),e.strokeStyle="rgba(255,255,255,0.6)",e.lineWidth=3,e.strokeRect(y,w,t,n)}catch{}}return c.forEach((r,o)=>{const t=860+o*140,n=Math.round(r.p*10)/10;e.fillStyle="#ffffff",e.font=o===0?"800 46px system-ui":"700 38px system-ui",e.fillText(`${o+1}. ${r.label}`,90,t),e.fillStyle="#c7d2fe",e.font="700 30px system-ui",e.fillText(`${n}%`,420,t),e.fillStyle="rgba(255,255,255,0.18)",e.fillRect(520,t-30,460,20),e.fillStyle=o===0?"#fbbf24":"#93c5fd",e.fillRect(520,t-30,Math.max(14,Math.min(460,n*4.6)),20),e.fillStyle="#dbeafe",e.font="500 24px system-ui",e.fillText(r.desc,90,t+38)}),e.fillStyle="rgba(255,255,255,0.72)",e.font="500 23px system-ui",e.fillText(i.shareCardBadge,80,1294),a}const g=q(P.get("r"));let l=null;if(L)l=JSON.parse(L);else if(g?.rows){const c=new Map(A.map(a=>[a.slug,a]));l=g.rows.map(a=>{const e=c.get(a.slug);return e?{...e,p:a.p}:null}).filter(Boolean)}g?.face&&!f&&(f=g.face);if(!l?.length)k.innerHTML=`<p>${i.empty}</p>`;else{const c=(l[0]?.p??0)-(l[1]?.p??0),a=c>=14?i.confidenceHigh:c>=8?i.confidenceMid:i.confidenceLow,e=c>=14?"confidence-high":c>=8?"confidence-mid":"confidence-low",s=c<8?`<div class="card"><p class="muted">${i.uncertain}</p><small class="muted">${i.retryGuide}</small></div>`:"",h=f?`<div class="card"><small class="muted">${i.facePreview}</small><div style="margin-top:8px"><img src="${f}" alt="detected face" style="width:100%;max-width:220px;border-radius:16px;border:1px solid #dbe5f3;display:block"/></div></div>`:"";k.innerHTML=`<div class="card confidence-card ${e}"><small class="kicker">${i.topPick}</small><br/><strong>${a}</strong><br/><small class="muted">${i.topHint}</small></div>`+s+h+l.map((r,o)=>{const t=Number.isFinite(r.p)?r.p:0,n=Math.max(0,Math.min(100,Math.round(t*10)/10));return`
    <div class="card result-card ${o===0?"top-card":""}">
      <small class="muted">${o+1}순위</small>
      <div class="result-top">${r.label} <span class="muted" style="font-size:22px">${n}%</span></div>
      <p>${r.desc}</p>
      <div class="bar"><i style="width:${n}%"></i></div>
    </div>`}).join(""),u&&(u.onclick=async()=>{const r=await N(l),o=await new Promise(n=>r.toBlob(n,"image/png"));if(!o)return;const t=new File([o],"nsolo-result.png",{type:"image/png"});try{if(navigator.share&&navigator.canShare?.({files:[t]}))await navigator.share({files:[t],title:"나는솔로 테스트 결과"});else{const n=document.createElement("a");n.href=URL.createObjectURL(o),n.download="nsolo-result.png",document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(n.href)}}catch{}}),d&&(d.onclick=async()=>{const r=new URL(location.href),o=await D(f);r.searchParams.set("lang",x),r.searchParams.set("r",E(l,o));const t=`${r.origin}${r.pathname}?${r.searchParams.toString()}`;let n=!1;try{await navigator.clipboard.writeText(t),n=!0}catch{}n&&(d.textContent=i.copied,B(i.copied,i.copiedDesc),setTimeout(()=>{d&&(d.textContent=i.shareLink)},1200));try{navigator.share&&await navigator.share({title:i.title,text:l?.[0]?.label,url:t})}catch{n||window.prompt("링크를 복사해 공유하세요",t)}})}U();

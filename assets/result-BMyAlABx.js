import"./styles-Cefnxvbk.js";import{i as x}from"./ads-D-IuExRI.js";import{N as v}from"./types-CWP0aW2C.js";const d=document.querySelector("#result"),p=document.querySelector("#share-image"),i=document.querySelector("#share-link"),h=sessionStorage.getItem("nsolo_result"),f=sessionStorage.getItem("nsolo_face"),S=new URLSearchParams(location.search),m=S.get("lang")||"ko",y={ko:{title:"나는 솔로에 나간다면 나의 이름은?",subtitle:"Top 3 이름 결과를 확인해보세요.",retry:"다시 분석",empty:"결과가 없습니다. 다시 분석해주세요.",uncertain:"유사한 타입이 겹쳐 보여요. 더 정면/근거리 얼굴 사진으로 다시 시도해보세요."},en:{title:"If you joined I AM SOLO, what would your name be?",subtitle:"Check your Top 3 name results.",retry:"Try Again",empty:"No result found. Please run analysis again.",uncertain:"The top matches are very close. Try again with a clearer front-face photo."},ja:{title:"나는 솔로 に出たら、私の名前は？",subtitle:"Top 3 名前の結果を確認してください。",retry:"もう一度分析",empty:"結果がありません。もう一度分析してください。",uncertain:"上位候補が近すぎます。正面で鮮明な顔写真で再試行してください。"}},c=y[m]||y.ko,g=document.querySelector(".hero h1"),b=document.querySelector(".hero p"),u=document.querySelector(".row .btn.ghost");g&&(g.textContent=c.title);b&&(b.textContent=c.subtitle);u&&(u.textContent=c.retry,u.href=`/scan.html?lang=${encodeURIComponent(m)}`);function T(r){return btoa(unescape(encodeURIComponent(JSON.stringify(r.map(a=>({slug:a.slug,p:a.p}))))))}function $(r){if(!r)return null;try{return JSON.parse(decodeURIComponent(escape(atob(r))))}catch{return null}}async function R(r){const a=document.createElement("canvas");a.width=1080,a.height=1350;const e=a.getContext("2d");if(e.fillStyle="#0f172a",e.fillRect(0,0,a.width,a.height),e.fillStyle="#ffffff",e.font="bold 56px system-ui",e.fillText("나는솔로 타입 결과",80,120),f)try{const n=await new Promise((o,s)=>{const t=new Image;t.onload=()=>o(t),t.onerror=s,t.src=f});e.save(),e.beginPath(),e.roundRect(80,170,240,240,24),e.clip(),e.drawImage(n,80,170,240,240),e.restore(),e.strokeStyle="#334155",e.lineWidth=2,e.strokeRect(80,170,240,240)}catch{}return e.fillStyle="#ffffff",e.font="42px system-ui",r.forEach((n,o)=>{const s=500+o*180,t=Math.round(n.p*10)/10;e.fillText(`${o+1}. ${n.label}  ${t}%`,80,s),e.font="30px system-ui",e.fillStyle="#cbd5e1",e.fillText(n.desc,120,s+48),e.fillStyle="#60a5fa",e.fillRect(120,s+70,Math.max(8,Math.min(760,t*7.6)),12),e.font="42px system-ui",e.fillStyle="#ffffff"}),e.fillStyle="#94a3b8",e.font="26px system-ui",e.fillText("오락용 아키타입 분류 · 실존 인물 식별 아님",80,1280),a}const w=$(S.get("r"));let l=null;if(h)l=JSON.parse(h);else if(w){const r=new Map(v.map(a=>[a.slug,a]));l=w.map(a=>{const e=r.get(a.slug);return e?{...e,p:a.p}:null}).filter(Boolean)}if(!l?.length)d.innerHTML=`<p>${c.empty}</p>`;else{const a=(l[0]?.p??0)-(l[1]?.p??0)<8?`<div class="card"><p class="muted">${c.uncertain}</p></div>`:"",e=f?`<div class="card"><small class="muted">탐지된 얼굴</small><div style="margin-top:8px"><img src="${f}" alt="detected face" style="width:100%;max-width:220px;border-radius:16px;border:1px solid #dbe5f3;display:block"/></div></div>`:"";d.innerHTML=a+e+l.map((n,o)=>{const s=Number.isFinite(n.p)?n.p:0,t=Math.max(0,Math.min(100,Math.round(s*10)/10));return`
    <div class="card result-card ${o===0?"top-card":""}">
      <small class="muted">${o+1}순위</small>
      <div class="result-top">${n.label} <span class="muted" style="font-size:22px">${t}%</span></div>
      <p>${n.desc}</p>
      <div class="bar"><i style="width:${t}%"></i></div>
    </div>`}).join(""),p&&(p.onclick=async()=>{const n=await R(l),o=await new Promise(t=>n.toBlob(t,"image/png"));if(!o)return;const s=new File([o],"nsolo-result.png",{type:"image/png"});try{if(navigator.share&&navigator.canShare?.({files:[s]}))await navigator.share({files:[s],title:"나는솔로 테스트 결과"});else{const t=document.createElement("a");t.href=URL.createObjectURL(o),t.download="nsolo-result.png",document.body.appendChild(t),t.click(),t.remove(),URL.revokeObjectURL(t.href)}}catch{}}),i&&(i.onclick=async()=>{const n=new URL(location.href);n.searchParams.set("lang",m),n.searchParams.set("r",T(l));const o=`${n.origin}${n.pathname}?${n.searchParams.toString()}`;await navigator.clipboard.writeText(o),i.textContent="복사됨!",setTimeout(()=>{i&&(i.textContent="결과 링크 복사")},1200)})}x();

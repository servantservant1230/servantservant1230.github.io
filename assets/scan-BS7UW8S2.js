import"./styles-BufaHF3D.js";const S=[{slug:"youngsoo",label:"영수",desc:"계획형·현실감각",gender:"male"},{slug:"youngho",label:"영호",desc:"부드러운 리더형",gender:"male"},{slug:"youngsik",label:"영식",desc:"센스·눈치 빠름",gender:"male"},{slug:"youngchul",label:"영철",desc:"직진·추진형",gender:"male"},{slug:"kwangsoo",label:"광수",desc:"개성·집중형",gender:"male"},{slug:"sangchul",label:"상철",desc:"안정·책임형",gender:"male"},{slug:"oksoon",label:"옥순",desc:"존재감·자신감형",gender:"female"},{slug:"youngsook",label:"영숙",desc:"배려·균형형",gender:"female"},{slug:"soonja",label:"순자",desc:"담백·차분형",gender:"female"},{slug:"youngja",label:"영자",desc:"솔직·쿨형",gender:"female"},{slug:"jungsook",label:"정숙",desc:"신중·정리형",gender:"female"},{slug:"hyunsook",label:"현숙",desc:"밝음·사교형",gender:"female"}];function R(e){const t=Math.max(...e),n=e.map(o=>Math.exp(o-t)),a=n.reduce((o,s)=>o+s,0);return n.map(o=>o/a)}const j=S.map((e,t)=>[Math.sin(t+1)*.8,Math.cos(t+2)*.7,Math.sin(t+3)*.6,Math.cos(t+4)*.5,Math.sin(t+5)*.4,Math.cos(t+6)*.3,Math.sin(t+7)*.2,Math.cos(t+8)*.1]),E=S.map((e,t)=>[Math.sin(t*.61),Math.cos(t*.73),Math.sin(t*.47),Math.cos(t*.59),Math.sin(t*.31),Math.cos(t*.43),Math.sin(t*.23),Math.cos(t*.17)]);function k(e,t){let n=0;for(let a=0;a<8;a++)n+=(e[a]??0)*(t[a]??0);return n}function L(e){const t=e.reduce((o,s)=>o+s,0)/e.length,n=e.reduce((o,s)=>o+(s-t)**2,0)/e.length,a=Math.sqrt(n)||1;return e.map(o=>(o-t)/a)}function A(e,t=.75,n=.25){const a=L(e);return j.map((o,s)=>t*k(o,a)+n*k(E[s],a))}function D(e,t){return new Set(["oksoon","hyunsook","youngja","youngho","youngsik","youngchul"]).has(e)?.01:t==="male"?.09:0}function O(e,t){const n=e.map(c=>({...c,p:Math.max(0,c.p+D(c.slug,t))})),a=n.reduce((c,r)=>c+r.p,0)||1,o=n.map(c=>({...c,p:c.p/a})),s=.18,u=1/o.length;return o.map(c=>({...c,p:(1-s)*c.p+s*u}))}function T(e,t){const n=R(A(e)),a=S.map((o,s)=>({...o,p:n[s]})).filter(o=>o.gender===t);return O(a,t).sort((o,s)=>s.p-o.p).slice(0,3)}function U(e){const t=e.data;let n=0,a=0,o=0,s=0,u=0;const c=t.length/4,r=e.width;for(let l=0;l<t.length;l+=4){const f=t[l],p=t[l+1],M=t[l+2],i=.299*f+.587*p+.114*M,y=Math.max(f,p,M),q=Math.min(f,p,M);n+=i,u+=y===0?0:(y-q)/y,l/4%r<r/2?o+=i:s+=i,l>4&&(a+=Math.abs(i-(.299*t[l-4]+.587*t[l-3]+.114*t[l-2])))}n/=c,o/=c/2,s/=c/2,u/=c;const h=Math.abs(o-s)/255;return[n/255,(o-s)/255,a/(c*255),(o+s)/510,u,h,Math.sin(a/100),Math.cos(n/50)]}const v=document.querySelector("#upload"),F=document.querySelector("#genderValue"),C=Array.from(document.querySelectorAll("[data-gender-btn]")),d=document.querySelector("#preview"),w=document.querySelector("#analyze"),g=document.querySelector("#status"),m=d.getContext("2d",{willReadFrequently:!0});let x=!1;function _(e){const n=e.map(r=>Math.pow(Math.max(r.p,1e-6),1.3888888888888888)),a=n.reduce((r,h)=>r+h,0)||1,s=n.map(r=>r/a*100).map(r=>Math.round(r*10)/10),u=s.reduce((r,h)=>r+h,0),c=Math.round((100-u)*10)/10;return s[0]=Math.max(0,Math.round((s[0]+c)*10)/10),e.map((r,h)=>({...r,p:s[h]}))}function I(e){F.value=e,C.forEach(t=>{const n=t.dataset.gender===e;t.classList.toggle("active",n),t.classList.toggle("secondary",n)})}C.forEach(e=>{e.onclick=()=>I(e.dataset.gender||"female")});I("female");function b(e){const t=Math.min(e.width,e.height),n=(e.width-t)/2,a=(e.height-t)/2;m.clearRect(0,0,d.width,d.height),m.drawImage(e,n,a,t,t,0,0,d.width,d.height)}async function z(e){const t=window.FaceDetector;if(!t)return b(e);const a=await new t({fastMode:!0,maxDetectedFaces:1}).detect(e);if(!a?.length)return b(e);const o=a[0].boundingBox,s=.35,u=o.x+o.width/2,c=o.y+o.height/2,r=Math.max(o.width,o.height)*(1+s*2),h=Math.max(0,Math.min(e.width-r,u-r/2)),l=Math.max(0,Math.min(e.height-r,c-r/2));m.clearRect(0,0,d.width,d.height),m.drawImage(e,h,l,r,r,0,0,d.width,d.height)}v.onchange=async()=>{const e=v.files?.[0];if(!e)return;const t=URL.createObjectURL(e),n=new Image;n.onload=async()=>{try{await z(n),x=!0,g.textContent="사진 업로드 완료 (얼굴 중심 정렬)"}catch{b(n),x=!0,g.textContent="사진 업로드 완료"}finally{URL.revokeObjectURL(t)}},n.src=t};w.onclick=()=>{if(!x){g.textContent="먼저 사진을 업로드해 주세요.";return}w.disabled=!0,g.textContent="분석 중...";const e=F.value||"female",t=224,n=224,a=document.createElement("canvas");a.width=t,a.height=n,a.getContext("2d").drawImage(d,0,0,t,n);const o=a.getContext("2d").getImageData(0,0,t,n),s=U(o),u=T(s,e),c=_(u);sessionStorage.setItem("nsolo_result",JSON.stringify(c)),sessionStorage.setItem("nsolo_gender",e),w.disabled=!1,window.location.href="/result.html"};
